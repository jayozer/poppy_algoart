<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poppy Landscape - Algorithmic Art</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Lora:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --anthropic-dark: #141413;
            --anthropic-light: #faf9f5;
            --anthropic-mid-gray: #b0aea5;
            --anthropic-light-gray: #e8e6dc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--anthropic-light) 0%, #f5f3ee 100%);
            min-height: 100vh;
            color: var(--anthropic-dark);
        }

        .container {
            display: flex;
            min-height: 100vh;
            padding: 20px;
            gap: 20px;
        }

        .sidebar {
            width: 320px;
            flex-shrink: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(20, 20, 19, 0.1);
            overflow-y: auto;
            max-height: 100vh;
        }

        .sidebar h1 {
            font-family: 'Lora', serif;
            font-size: 24px;
            font-weight: 500;
            color: var(--anthropic-dark);
            margin-bottom: 8px;
        }

        .sidebar .subtitle {
            color: var(--anthropic-mid-gray);
            font-size: 14px;
            margin-bottom: 32px;
            line-height: 1.4;
        }

        .control-section { margin-bottom: 28px; }

        .control-section h3 {
            font-size: 15px;
            font-weight: 600;
            color: var(--anthropic-dark);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-section h3::before {
            content: '•';
            color: #F7931E;
            font-weight: bold;
        }

        .seed-input {
            width: 100%;
            background: var(--anthropic-light);
            padding: 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 12px;
            border: 1px solid var(--anthropic-light-gray);
            text-align: center;
        }

        .seed-input:focus {
            outline: none;
            border-color: #F7931E;
            box-shadow: 0 0 0 2px rgba(247, 147, 30, 0.1);
            background: white;
        }

        .seed-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .control-group { margin-bottom: 16px; }

        .control-group label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--anthropic-dark);
            margin-bottom: 6px;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider-container input[type="range"] {
            flex: 1;
            height: 4px;
            background: var(--anthropic-light-gray);
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #F7931E;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider-container input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: #F7931E;
            border-radius: 50%;
            border: none;
            cursor: pointer;
        }

        .value-display {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: var(--anthropic-mid-gray);
            min-width: 40px;
            text-align: right;
        }

        .button {
            width: 100%;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--anthropic-light);
            color: var(--anthropic-dark);
            border: 1px solid var(--anthropic-light-gray);
        }

        .button:hover { background: var(--anthropic-light-gray); }

        .button.primary {
            background: #F7931E;
            color: white;
            border: none;
        }

        .button.primary:hover { background: #e0841a; }

        .button-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .button-row .button { flex: 1; }

        .canvas-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 20px;
        }

        #canvas-container {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(20, 20, 19, 0.15);
        }

        .loading {
            color: var(--anthropic-mid-gray);
            font-size: 14px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #F7931E;
        }

        .checkbox-group label {
            font-size: 13px;
            margin-bottom: 0;
        }

        /* Kid-friendly styles */
        .big-button {
            padding: 16px 20px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 12px;
            margin-top: 8px;
        }

        .toggle-group {
            margin-bottom: 16px;
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 12px 16px;
            background: var(--anthropic-light);
            border-radius: 10px;
            border: 2px solid var(--anthropic-light-gray);
            transition: all 0.2s ease;
        }

        .toggle-label:hover {
            border-color: #F7931E;
        }

        .toggle-label input[type="checkbox"] {
            width: 24px;
            height: 24px;
            accent-color: #F7931E;
        }

        .toggle-text {
            font-size: 16px;
            font-weight: 500;
        }

        .email-note {
            font-size: 12px;
            color: var(--anthropic-mid-gray);
            text-align: center;
            margin-top: 8px;
            min-height: 18px;
        }

        .email-note.success {
            color: #4CAF50;
        }

        .email-note.error {
            color: #f44336;
        }

        .seed-input::placeholder {
            color: var(--anthropic-mid-gray);
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>Poppy Garden</h1>
            <p class="subtitle">Create your own magical flower garden!</p>

            <div class="control-section">
                <h3>What's your name?</h3>
                <input type="text" id="seed-input" class="seed-input" value="Poppy" placeholder="Type your name here">
                <button class="button primary" onclick="updateSeed()">Create My Garden!</button>
            </div>

            <div class="control-section">
                <h3>Landscape</h3>

                <div class="checkbox-group">
                    <input type="checkbox" id="showSun" checked onchange="updateCheckbox('showSun', this.checked)">
                    <label for="showSun">Sunny Day</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="showButterflies" checked onchange="updateCheckbox('showButterflies', this.checked)">
                    <label for="showButterflies">Butterflies</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="showClouds" checked onchange="updateCheckbox('showClouds', this.checked)">
                    <label for="showClouds">Clouds</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="showMountains" checked onchange="updateCheckbox('showMountains', this.checked)">
                    <label for="showMountains">Mountains</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="showWater" checked onchange="updateCheckbox('showWater', this.checked)">
                    <label for="showWater">Water</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="showRocks" checked onchange="updateCheckbox('showRocks', this.checked)">
                    <label for="showRocks">Rocks</label>
                </div>

                <div class="control-group">
                    <label>Horizon Height</label>
                    <div class="slider-container">
                        <input type="range" id="horizonHeight" min="0.25" max="0.55" step="0.02" value="0.38" oninput="updateParam('horizonHeight', this.value)">
                        <span class="value-display" id="horizonHeight-value">0.38</span>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3>Poppy Field</h3>

                <div class="control-group">
                    <label>Poppy Density</label>
                    <div class="slider-container">
                        <input type="range" id="poppyDensity" min="50" max="300" step="10" value="150" oninput="updateParam('poppyDensity', this.value)">
                        <span class="value-display" id="poppyDensity-value">150</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Petal Waviness</label>
                    <div class="slider-container">
                        <input type="range" id="petalWaviness" min="0" max="0.5" step="0.05" value="0.25" oninput="updateParam('petalWaviness', this.value)">
                        <span class="value-display" id="petalWaviness-value">0.25</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Wind Sway</label>
                    <div class="slider-container">
                        <input type="range" id="windSway" min="0" max="0.4" step="0.02" value="0.15" oninput="updateParam('windSway', this.value)">
                        <span class="value-display" id="windSway-value">0.15</span>
                    </div>
                </div>

                <div class="control-group">
                    <label>Rock Amount</label>
                    <div class="slider-container">
                        <input type="range" id="rockAmount" min="0" max="30" step="2" value="12" oninput="updateParam('rockAmount', this.value)">
                        <span class="value-display" id="rockAmount-value">12</span>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <h3>Send to Parent</h3>
                <input type="email" id="parent-email" class="seed-input" placeholder="parent@email.com">
                <button class="button primary" onclick="sendEmail()">Send My Picture!</button>
                <p class="email-note" id="email-status"></p>
            </div>

            <div class="control-section">
                <h3>Actions</h3>
                <button class="button" onclick="randomSeedAndUpdate()" style="margin-bottom: 8px;">Surprise Me!</button>
                <button class="button" onclick="resetParameters()">Reset All</button>
            </div>
        </div>

        <div class="canvas-area">
            <div id="canvas-container">
                <div class="loading">Painting landscape...</div>
            </div>
        </div>
    </div>

    <script>
        // ═══════════════════════════════════════════════════════════════════════
        // POPPY LANDSCAPE - PARAMETERS
        // ═══════════════════════════════════════════════════════════════════════

        let params = {
            seedName: "Poppy",
            seed: 0,  // Computed from seedName
            horizonHeight: 0.38,
            poppyDensity: 150,
            petalWaviness: 0.25,
            windSway: 0.15,
            rockAmount: 12,
            showClouds: true,
            showMountains: true,
            showWater: true,
            showRocks: true,
            showSun: true,
            showButterflies: true
        };

        let defaultParams = JSON.parse(JSON.stringify(params));

        // ═══════════════════════════════════════════════════════════════════════
        // STRING HASH FUNCTION
        // ═══════════════════════════════════════════════════════════════════════

        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32-bit integer
            }
            return Math.abs(hash) || 1; // Ensure non-zero
        }

        // ═══════════════════════════════════════════════════════════════════════
        // P5.JS SETUP
        // ═══════════════════════════════════════════════════════════════════════

        function setup() {
            let canvas = createCanvas(900, 700);
            canvas.parent('canvas-container');
            noLoop();
            // Compute initial seed from name
            params.seed = hashString(params.seedName);
            generateLandscape();
            document.querySelector('.loading').style.display = 'none';
        }

        function generateLandscape() {
            randomSeed(params.seed);
            noiseSeed(params.seed);

            // Draw layers back to front
            drawSky();
            if (params.showSun) drawSun();
            if (params.showClouds) drawClouds();
            if (params.showMountains) drawMountains();
            if (params.showWater) drawWater();
            drawMarshland();
            drawPoppyField();
            if (params.showButterflies) drawButterflies();
            drawNameOnArt();
        }

        function draw() {
            // Static - no animation
        }

        // ═══════════════════════════════════════════════════════════════════════
        // SKY
        // ═══════════════════════════════════════════════════════════════════════

        function drawSky() {
            let horizonY = height * params.horizonHeight;
            
            // Gradient sky - deep blue at top to lighter at horizon
            for (let y = 0; y < horizonY; y++) {
                let t = y / horizonY;
                let skyColor = lerpColor(
                    color(65, 145, 220),   // Deep sky blue
                    color(160, 210, 245),  // Light horizon blue
                    t * t  // Quadratic for more blue at top
                );
                stroke(skyColor);
                line(0, y, width, y);
            }
        }

        // ═══════════════════════════════════════════════════════════════════════
        // CLOUDS
        // ═══════════════════════════════════════════════════════════════════════

        function drawClouds() {
            let horizonY = height * params.horizonHeight;
            
            // Generate wispy clouds
            let cloudCount = floor(random(4, 8));
            
            for (let c = 0; c < cloudCount; c++) {
                let cx = random(width);
                let cy = random(horizonY * 0.15, horizonY * 0.7);
                let cloudWidth = random(100, 300);
                let cloudHeight = random(20, 60);
                
                drawWispyCloud(cx, cy, cloudWidth, cloudHeight);
            }
        }

        function drawWispyCloud(cx, cy, w, h) {
            noStroke();
            
            // Multiple overlapping ellipses for fluffy effect
            let puffCount = floor(random(8, 15));
            
            for (let i = 0; i < puffCount; i++) {
                let px = cx + random(-w/2, w/2);
                let py = cy + random(-h/2, h/2);
                let psize = random(30, 80);
                
                // Gradient alpha for soft edges
                for (let r = psize; r > 0; r -= 5) {
                    let alpha = map(r, 0, psize, 80, 0);
                    fill(255, 255, 255, alpha);
                    ellipse(px, py, r, r * 0.6);
                }
            }
        }

        // ═══════════════════════════════════════════════════════════════════════
        // MOUNTAINS
        // ═══════════════════════════════════════════════════════════════════════

        function drawMountains() {
            let horizonY = height * params.horizonHeight;
            
            // Distant mountain range - subtle blue-gray
            noStroke();
            
            // Back mountain layer
            fill(140, 160, 180, 180);
            beginShape();
            vertex(0, horizonY);
            
            let x = 0;
            while (x < width + 50) {
                let mountainHeight = noise(x * 0.003, params.seed) * 60 + 20;
                vertex(x, horizonY - mountainHeight);
                x += random(30, 60);
            }
            vertex(width, horizonY);
            endShape(CLOSE);
            
            // Front mountain layer - slightly darker
            fill(100, 120, 140, 150);
            beginShape();
            vertex(0, horizonY);
            
            x = 0;
            while (x < width + 50) {
                let mountainHeight = noise(x * 0.004 + 100, params.seed) * 40 + 10;
                vertex(x, horizonY - mountainHeight);
                x += random(20, 50);
            }
            vertex(width, horizonY);
            endShape(CLOSE);
        }

        // ═══════════════════════════════════════════════════════════════════════
        // WATER / WETLAND
        // ═══════════════════════════════════════════════════════════════════════

        function drawWater() {
            let horizonY = height * params.horizonHeight;
            let waterTop = horizonY;
            let waterBottom = horizonY + height * 0.15;
            
            // Water body with subtle reflection
            for (let y = waterTop; y < waterBottom; y++) {
                let t = (y - waterTop) / (waterBottom - waterTop);
                let waterColor = lerpColor(
                    color(130, 175, 200),  // Reflecting sky
                    color(90, 130, 150),   // Deeper water
                    t
                );
                
                // Add subtle wave noise
                let waveNoise = noise(y * 0.05, params.seed) * 10;
                stroke(waterColor);
                line(0, y, width, y);
            }
            
            // Winding water channel through marsh
            noFill();
            stroke(110, 155, 180);
            strokeWeight(3);
            
            beginShape();
            let startX = random(width * 0.3, width * 0.5);
            vertex(startX, waterBottom);
            
            let cx = startX;
            for (let y = waterBottom; y < height * 0.65; y += 30) {
                cx += random(-40, 40);
                cx = constrain(cx, width * 0.2, width * 0.7);
                let wobble = noise(y * 0.02, params.seed) * 30 - 15;
                curveVertex(cx + wobble, y);
            }
            endShape();
            
            strokeWeight(1);
        }

        // ═══════════════════════════════════════════════════════════════════════
        // MARSHLAND / GRASS
        // ═══════════════════════════════════════════════════════════════════════

        function drawMarshland() {
            let horizonY = height * params.horizonHeight;
            let marshStart = horizonY + (params.showWater ? height * 0.12 : 0);
            
            // Green marshland
            noStroke();
            
            // Base marsh color
            for (let y = marshStart; y < height; y++) {
                let t = (y - marshStart) / (height - marshStart);
                let marshColor = lerpColor(
                    color(85, 110, 70),    // Distant marsh
                    color(75, 120, 55),    // Closer grass
                    t
                );
                
                // Variation
                let variation = noise(y * 0.02, params.seed * 2) * 20 - 10;
                stroke(red(marshColor) + variation, green(marshColor) + variation, blue(marshColor));
                line(0, y, width, y);
            }
            
            // Add grass texture in foreground
            let grassStart = height * 0.6;
            for (let i = 0; i < 500; i++) {
                let gx = random(width);
                let gy = random(grassStart, height);
                let grassHeight = map(gy, grassStart, height, 5, 25);
                
                stroke(60 + random(30), 100 + random(40), 40 + random(30), 150);
                strokeWeight(1);
                
                let sway = noise(gx * 0.01, params.seed) * params.windSway * 20;
                line(gx, gy, gx + sway, gy - grassHeight);
            }
        }

        // ═══════════════════════════════════════════════════════════════════════
        // POPPY FIELD
        // ═══════════════════════════════════════════════════════════════════════

        function drawPoppyField() {
            let poppies = [];
            let fieldStart = height * 0.5;
            
            // Generate poppy positions with depth-based sizing
            for (let i = 0; i < params.poppyDensity; i++) {
                let py = random(fieldStart, height - 20);
                let px = random(-20, width + 20);
                
                // Size based on depth (larger in foreground)
                let depthFactor = map(py, fieldStart, height, 0.3, 1.2);
                let size = random(15, 35) * depthFactor;
                
                poppies.push({
                    x: px,
                    y: py,
                    size: size,
                    rotation: random(-0.3, 0.3),
                    petalVar: random(0.8, 1.2),
                    hueShift: random(-15, 15),
                    isBud: random() < 0.15,
                    petalCount: floor(random(4, 6)),
                    depth: py
                });
            }
            
            // Draw rocks first (behind some poppies)
            if (params.showRocks) {
                drawRocks();
            }
            
            // Sort by depth and draw
            poppies.sort((a, b) => a.depth - b.depth);
            
            for (let p of poppies) {
                drawFieldPoppy(p);
            }
        }

        // ═══════════════════════════════════════════════════════════════════════
        // ROCKS
        // ═══════════════════════════════════════════════════════════════════════

        function drawRocks() {
            let rockStart = height * 0.7;
            
            for (let i = 0; i < params.rockAmount; i++) {
                let rx = random(width);
                let ry = random(rockStart, height - 10);
                let rsize = random(20, 50) * map(ry, rockStart, height, 0.5, 1.3);
                
                drawRock(rx, ry, rsize);
            }
        }

        function drawRock(x, y, size) {
            push();
            translate(x, y);

            // Irregular rock shape
            let baseGray = random(80, 130);
            fill(baseGray, baseGray - 10, baseGray - 20);
            noStroke();

            beginShape();
            let points = floor(random(6, 10));
            for (let i = 0; i < points; i++) {
                let angle = (TWO_PI / points) * i;
                let r = size * random(0.4, 0.6);
                let px = cos(angle) * r;
                let py = sin(angle) * r * 0.6; // Flatten vertically
                vertex(px, py);
            }
            endShape(CLOSE);

            // Highlight
            fill(baseGray + 40, baseGray + 30, baseGray + 20, 80);
            ellipse(-size * 0.1, -size * 0.1, size * 0.3, size * 0.2);

            pop();
        }

        // ═══════════════════════════════════════════════════════════════════════
        // INDIVIDUAL POPPY
        // ═══════════════════════════════════════════════════════════════════════

        function drawFieldPoppy(p) {
            push();
            translate(p.x, p.y);
            
            // Wind sway
            let sway = noise(p.x * 0.01, p.y * 0.01, params.seed) * params.windSway;
            rotate(sway);
            
            // Draw stem
            let stemCol = color(70 + random(20), 110 + random(30), 50 + random(20));
            stroke(stemCol);
            strokeWeight(map(p.size, 10, 50, 1, 2.5));
            noFill();
            
            let stemHeight = p.size * random(2, 3.5);
            let curveMag = random(-20, 20) * (p.size / 30);
            
            beginShape();
            vertex(0, 0);
            bezierVertex(
                curveMag * 0.3, -stemHeight * 0.3,
                -curveMag * 0.5, -stemHeight * 0.7,
                curveMag * 0.2, -stemHeight
            );
            endShape();
            
            // Draw flower at top
            push();
            translate(curveMag * 0.2, -stemHeight);
            rotate(p.rotation);
            
            if (p.isBud) {
                drawPoppyBud(p.size * 0.5, stemCol);
            } else {
                drawPoppyFlower(p);
            }
            
            pop();
            pop();
        }

        function drawPoppyFlower(p) {
            // Petal color with variation
            let baseHue = 25 + p.hueShift; // Orange range
            let petalFill = color(
                240 + random(-20, 20),
                100 + random(-30, 30),
                30 + random(-20, 20)
            );
            let petalStroke = color(
                200 + random(-20, 20),
                70 + random(-20, 20),
                20
            );
            
            // Draw petals
            for (let i = 0; i < p.petalCount; i++) {
                push();
                rotate((TWO_PI / p.petalCount) * i + random(-0.15, 0.15));
                drawPetal(p.size * p.petalVar, petalFill, petalStroke);
                pop();
            }
            
            // Center
            fill(255, 210, 60);
            noStroke();
            ellipse(0, 0, p.size * 0.2, p.size * 0.2);
            
            // Stamens
            stroke(220, 160, 40);
            strokeWeight(0.5);
            for (let i = 0; i < 8; i++) {
                let a = (TWO_PI / 8) * i;
                let len = p.size * 0.15;
                line(0, 0, cos(a) * len, sin(a) * len);
            }
        }

        function drawPetal(size, fillCol, strokeCol) {
            let w = size * 0.55;
            let h = size;
            let waviness = params.petalWaviness;

            let wave1 = random(-waviness, waviness) * w * 0.4;
            let wave2 = random(-waviness, waviness) * w * 0.4;

            fill(fillCol);
            noStroke();

            beginShape();
            vertex(0, 0);
            bezierVertex(-w * 0.3 + wave1, -h * 0.2, -w * 0.7, -h * 0.5, -w * 0.4 + wave2, -h * 0.85);
            bezierVertex(-w * 0.15, -h, w * 0.15, -h, w * 0.4 - wave2, -h * 0.85);
            bezierVertex(w * 0.7, -h * 0.5, w * 0.3 - wave1, -h * 0.2, 0, 0);
            endShape(CLOSE);
        }

        function drawPoppyBud(size, stemCol) {
            // Closed bud
            fill(stemCol);
            stroke(red(stemCol) - 20, green(stemCol) - 20, blue(stemCol) - 20);
            strokeWeight(1);

            ellipse(0, -size * 0.3, size * 0.4, size * 0.7);

            // Hint of orange
            fill(240, 120, 40);
            noStroke();
            ellipse(0, -size * 0.4, size * 0.15, size * 0.2);
        }

        // ═══════════════════════════════════════════════════════════════════════
        // SUN
        // ═══════════════════════════════════════════════════════════════════════

        function drawSun() {
            let sunX = width - 100;
            let sunY = 80;
            let sunRadius = 45;

            push();
            translate(sunX, sunY);

            // Sun rays
            stroke(255, 220, 100);
            strokeWeight(3);
            for (let i = 0; i < 12; i++) {
                let angle = (TWO_PI / 12) * i;
                let innerR = sunRadius + 10;
                let outerR = sunRadius + 25 + random(5);
                line(
                    cos(angle) * innerR, sin(angle) * innerR,
                    cos(angle) * outerR, sin(angle) * outerR
                );
            }

            // Sun body
            noStroke();
            fill(255, 230, 100);
            ellipse(0, 0, sunRadius * 2, sunRadius * 2);

            // Lighter center
            fill(255, 245, 180);
            ellipse(-5, -5, sunRadius * 1.2, sunRadius * 1.2);

            // Smiley face
            fill(80, 60, 20);
            // Eyes
            ellipse(-12, -8, 8, 10);
            ellipse(12, -8, 8, 10);
            // Eye shine
            fill(255);
            ellipse(-14, -10, 3, 3);
            ellipse(10, -10, 3, 3);

            // Smile
            noFill();
            stroke(80, 60, 20);
            strokeWeight(3);
            arc(0, 5, 30, 20, 0.2, PI - 0.2);

            // Rosy cheeks
            noStroke();
            fill(255, 180, 150, 150);
            ellipse(-25, 5, 12, 8);
            ellipse(25, 5, 12, 8);

            pop();
        }

        // ═══════════════════════════════════════════════════════════════════════
        // BUTTERFLIES
        // ═══════════════════════════════════════════════════════════════════════

        function drawButterflies() {
            let butterflyCount = floor(random(6, 14));
            let horizonY = height * params.horizonHeight;

            for (let i = 0; i < butterflyCount; i++) {
                let bx = random(50, width - 50);
                let by = random(horizonY + 50, height - 100);
                let bsize = random(15, 30);
                let rotation = random(-0.4, 0.4);

                // Butterfly colors - bright and cheerful
                let colors = [
                    [255, 150, 50],   // Orange
                    [255, 200, 50],   // Yellow
                    [255, 130, 180],  // Pink
                    [130, 180, 255],  // Light blue
                    [180, 130, 255],  // Purple
                    [130, 220, 180]   // Mint
                ];
                let col = colors[floor(random(colors.length))];

                drawButterfly(bx, by, bsize, rotation, col);
            }
        }

        function drawButterfly(x, y, size, rot, col) {
            push();
            translate(x, y);
            rotate(rot);

            // Wing color - no stroke for cleaner look
            fill(col[0], col[1], col[2], 230);
            noStroke();

            // Left wings
            ellipse(-size * 0.4, -size * 0.2, size * 0.8, size * 0.6); // Upper
            ellipse(-size * 0.3, size * 0.2, size * 0.5, size * 0.4);  // Lower

            // Right wings
            ellipse(size * 0.4, -size * 0.2, size * 0.8, size * 0.6);  // Upper
            ellipse(size * 0.3, size * 0.2, size * 0.5, size * 0.4);   // Lower

            // Wing patterns - dots
            fill(255, 255, 255, 180);
            ellipse(-size * 0.4, -size * 0.2, size * 0.2, size * 0.15);
            ellipse(size * 0.4, -size * 0.2, size * 0.2, size * 0.15);

            // Body
            fill(60, 40, 30);
            ellipse(0, 0, size * 0.15, size * 0.5);

            // Antennae
            stroke(60, 40, 30);
            strokeWeight(1);
            noFill();
            bezier(0, -size * 0.2, -size * 0.1, -size * 0.4, -size * 0.15, -size * 0.5, -size * 0.1, -size * 0.55);
            bezier(0, -size * 0.2, size * 0.1, -size * 0.4, size * 0.15, -size * 0.5, size * 0.1, -size * 0.55);

            pop();
        }

        // ═══════════════════════════════════════════════════════════════════════
        // NAME ON ARTWORK
        // ═══════════════════════════════════════════════════════════════════════

        function drawNameOnArt() {
            let name = params.seedName;
            let displayText = name + "'s Poppy Field";

            // Position in bottom right
            let x = width - 20;
            let y = height - 20;

            push();
            textAlign(RIGHT, BOTTOM);
            textSize(24);
            textStyle(BOLD);

            // Shadow
            fill(0, 0, 0, 80);
            text(displayText, x + 2, y + 2);

            // White text with slight stroke for readability
            fill(255, 255, 255);
            stroke(60, 80, 50);
            strokeWeight(2);
            text(displayText, x, y);

            pop();
        }

        // ═══════════════════════════════════════════════════════════════════════
        // UI HANDLERS
        // ═══════════════════════════════════════════════════════════════════════

        function updateParam(paramName, value) {
            if (paramName === 'poppyDensity' || paramName === 'rockAmount') {
                params[paramName] = parseInt(value);
            } else {
                params[paramName] = parseFloat(value);
            }
            document.getElementById(paramName + '-value').textContent = value;
            redraw();
            generateLandscape();
        }

        function updateCheckbox(paramName, value) {
            params[paramName] = value;
            redraw();
            generateLandscape();
        }

        function updateSeedDisplay() {
            document.getElementById('seed-input').value = params.seedName;
        }

        function updateSeed() {
            let input = document.getElementById('seed-input');
            let name = input.value.trim();
            if (name) {
                params.seedName = name;
                params.seed = hashString(name);
                redraw();
                generateLandscape();
            } else {
                updateSeedDisplay();
            }
        }

        function randomSeedAndUpdate() {
            // Fun random names for kids
            const funNames = [
                "Sunny", "Daisy", "Blossom", "Petal", "Rosie", "Lily", "Violet", "Clover",
                "Buttercup", "Marigold", "Jasmine", "Iris", "Tulip", "Willow", "Fern",
                "Sky", "Rainbow", "Sparkle", "Twinkle", "Star", "Moon", "Cloud",
                "Honey", "Maple", "Berry", "Peach", "Cherry", "Plum", "Mango",
                "Ziggy", "Zippy", "Fizzy", "Dizzy", "Jazzy", "Snappy", "Happy",
                "Bubbles", "Giggles", "Sprout", "Pip", "Bean", "Pebble", "Acorn"
            ];
            params.seedName = funNames[Math.floor(Math.random() * funNames.length)];
            params.seed = hashString(params.seedName);
            updateSeedDisplay();
            redraw();
            generateLandscape();
        }

        function resetParameters() {
            params = JSON.parse(JSON.stringify(defaultParams));
            // Recompute seed from default name
            params.seed = hashString(params.seedName);

            // Update sliders
            document.getElementById('horizonHeight').value = params.horizonHeight;
            document.getElementById('horizonHeight-value').textContent = params.horizonHeight;
            document.getElementById('poppyDensity').value = params.poppyDensity;
            document.getElementById('poppyDensity-value').textContent = params.poppyDensity;
            document.getElementById('petalWaviness').value = params.petalWaviness;
            document.getElementById('petalWaviness-value').textContent = params.petalWaviness;
            document.getElementById('windSway').value = params.windSway;
            document.getElementById('windSway-value').textContent = params.windSway;
            document.getElementById('rockAmount').value = params.rockAmount;
            document.getElementById('rockAmount-value').textContent = params.rockAmount;

            // Update checkboxes
            document.getElementById('showSun').checked = params.showSun;
            document.getElementById('showButterflies').checked = params.showButterflies;
            document.getElementById('showClouds').checked = params.showClouds;
            document.getElementById('showMountains').checked = params.showMountains;
            document.getElementById('showWater').checked = params.showWater;
            document.getElementById('showRocks').checked = params.showRocks;

            updateSeedDisplay();
            redraw();
            generateLandscape();
        }

        // ═══════════════════════════════════════════════════════════════════════
        // EMAIL FUNCTIONALITY
        // ═══════════════════════════════════════════════════════════════════════

        // EmailJS Configuration
        const EMAILJS_PUBLIC_KEY = "iCYQeAoYk8NU2LfLK";
        const EMAILJS_SERVICE_ID = "pkart_novato";
        const EMAILJS_TEMPLATE_ID = "poppy_garden_art";

        function initEmailJS() {
            if (typeof emailjs !== 'undefined' && EMAILJS_PUBLIC_KEY !== "YOUR_PUBLIC_KEY") {
                emailjs.init(EMAILJS_PUBLIC_KEY);
            }
        }

        function sendEmail() {
            const emailInput = document.getElementById('parent-email');
            const statusEl = document.getElementById('email-status');
            const email = emailInput.value.trim();

            // Validate email
            if (!email || !email.includes('@')) {
                statusEl.textContent = "Please enter a valid email address";
                statusEl.className = "email-note error";
                return;
            }

            // Check if EmailJS is configured
            if (EMAILJS_PUBLIC_KEY === "YOUR_PUBLIC_KEY") {
                statusEl.textContent = "Email not configured yet - ask staff for help!";
                statusEl.className = "email-note error";
                return;
            }

            statusEl.textContent = "Sending your picture...";
            statusEl.className = "email-note";

            // Get canvas as base64 image
            const canvas = document.querySelector('canvas');
            const imageData = canvas.toDataURL('image/png');

            // Send email via EmailJS
            emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
                to_email: email,
                child_name: params.seedName,
                image_data: imageData
            }).then(
                function() {
                    statusEl.textContent = "Sent! Check your email!";
                    statusEl.className = "email-note success";
                    emailInput.value = "";
                },
                function(error) {
                    console.error('Email error:', error);
                    statusEl.textContent = "Oops! Something went wrong. Try again?";
                    statusEl.className = "email-note error";
                }
            );
        }

        window.addEventListener('load', function() {
            updateSeedDisplay();
            initEmailJS();
        });
    </script>
</body>
</html>
